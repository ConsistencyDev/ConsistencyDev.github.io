"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const os_1 = require("os");
const Koa = require("koa");
const KoaBodyParser = require("koa-bodyparser");
const KoaStatic = require("koa-static");
const storage_1 = require("./routes/storage");
const tools_1 = require("./routes/tools");
class WebServer {
    /**
     * Constructor
     * @param port: the port
     */
    constructor(port) {
        this.application = new Koa();
        this.application.proxy = true;
        this.application.use(KoaBodyParser({
            formLimit: '200mb',
            jsonLimit: '200mb'
        }));
        this.application.use(KoaStatic('.'));
        new storage_1.default(this.application);
        new tools_1.default(this.application);
    }
    /**
     * Listen to the given port
     * @param port the port to listen
     */
    listen(port, address) {
        if (address) {
            this.application.listen(port, address);
            return;
        }
        const interfaces = os_1.networkInterfaces();
        for (const i in interfaces) {
            for (const j of interfaces[i]) {
                if (!j.internal && j.family === 'IPv4') {
                    this.application.listen(port, j.address);
                    return;
                }
            }
        }
    }
}
exports.default = WebServer;
//# sourceMappingURL=web-server.js.map