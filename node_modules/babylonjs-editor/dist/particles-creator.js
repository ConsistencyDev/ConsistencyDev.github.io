!function(e){function t(e){Object.defineProperty(this,e,{enumerable:!0,get:function(){return this[v][e]}})}function r(e){if("undefined"!=typeof System&&System.isModule?System.isModule(e):"[object Module]"===Object.prototype.toString.call(e))return e;var t={default:e,__useDefault:e};if(e&&e.__esModule)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return new o(t)}function o(e){Object.defineProperty(this,v,{value:e}),Object.keys(e).forEach(t,this)}function n(e){return"@node/"===e.substr(0,6)?c(e,r(m(e.substr(6))),{}):p[e]}function u(e){var t=n(e);if(!t)throw new Error('Module "'+e+'" expected, but not contained in build.');if(t.module)return t.module;var r=t.linkRecord;return i(t,r),a(t,r,[]),t.module}function i(e,t){if(!t.depLoads){t.declare&&d(e,t),t.depLoads=[];for(var r=0;r<t.deps.length;r++){var o=n(t.deps[r]);t.depLoads.push(o),o.linkRecord&&i(o,o.linkRecord);var u=t.setters&&t.setters[r];u&&(u(o.module||o.linkRecord.moduleObj),o.importerSetters.push(u))}return e}}function d(t,r){var o=r.moduleObj,n=t.importerSetters,u=!1,i=r.declare.call(e,function(e,t){if(!u){if("object"==typeof e)for(var r in e)"__useDefault"!==r&&(o[r]=e[r]);else o[e]=t;u=!0;for(var i=0;i<n.length;i++)n[i](o);return u=!1,t}},{id:t.key});"function"!=typeof i?(r.setters=i.setters,r.execute=i.execute):(r.setters=[],r.execute=i)}function l(e,t,r){return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:r,setters:void 0,execute:void 0,moduleObj:{}}}}function f(e,t,r,o){var n={};return p[e]={key:e,module:void 0,importerSetters:[],linkRecord:{deps:t,depLoads:void 0,declare:void 0,execute:o,executingRequire:r,moduleObj:{default:n,__useDefault:n},setters:void 0}}}function s(e,t,r){return function(o){for(var n=0;n<e.length;n++)if(e[n]===o){var u,i=t[n],d=i.linkRecord;return u=d?-1===r.indexOf(i)?a(i,d,r):d.moduleObj:i.module,"__useDefault"in u?u.__useDefault:u}}}function a(t,r,n){if(n.push(t),t.module)return t.module;if(r.setters){for(var i=0;i<r.deps.length;i++){var d=r.depLoads[i],l=d.linkRecord;l&&-1===n.indexOf(d)&&a(d,l,l.setters?n:[])}r.execute.call(y)}else{var f={id:t.key},c=r.moduleObj;Object.defineProperty(f,"exports",{configurable:!0,set:function(e){c.default=c.__useDefault=e},get:function(){return c.__useDefault}});var p=s(r.deps,r.depLoads,n);if(!r.executingRequire)for(var i=0;i<r.deps.length;i++)p(r.deps[i]);var v=r.execute.call(e,p,c.__useDefault,f);void 0!==v?c.default=c.__useDefault=v:f.exports!==c.__useDefault&&(c.default=c.__useDefault=f.exports);var m=c.__useDefault;if(m&&m.__esModule)for(var b in m)Object.hasOwnProperty.call(m,b)&&(c[b]=m[b])}var f=t.module=new o(r.moduleObj);if(!r.setters)for(var i=0;i<t.importerSetters.length;i++)t.importerSetters[i](f);return f}function c(e,t){return p[e]={key:e,module:t,importerSetters:[],linkRecord:void 0}}var p={},v="undefined"!=typeof Symbol?Symbol():"@@baseObject";o.prototype=Object.create(null),"undefined"!=typeof Symbol&&Symbol.toStringTag&&(o.prototype[Symbol.toStringTag]="Module");var m="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&void 0!==require.resolve&&"undefined"!=typeof process&&process.platform&&require,y={};return Object.freeze&&Object.freeze(y),function(e,t,n,i){return function(d){d(function(d){var s={_nodeRequire:m,register:l,registerDynamic:f,registry:{get:function(e){return p[e].module},set:c},newModule:function(e){return new o(e)}};c("@empty",new o({}));for(var a=0;a<t.length;a++)c(t[a],r(arguments[a],{}));i(s);var v=u(e[0]);if(e.length>1)for(var a=1;a<e.length;a++)u(e[a]);return n?v.__useDefault:(v instanceof o&&Object.defineProperty(v,"__esModule",{value:!0}),v)})}}}("undefined"!=typeof self?self:"undefined"!=typeof global?global:this)(["a"],["d","f","e"],!0,function($__System){this.require,this.exports,this.module;$__System.registerDynamic("b",[],!0,function($__require,exports,module){"use strict";this||self;Object.defineProperty(exports,"__esModule",{value:!0});var Extension=function(){function Extension(scene){this.alwaysApply=!1,this.scene=scene}return Extension.AddScript=function(code,url){var script=document.createElement("script");return script.type="text/javascript",script.text=code+"\n//# sourceURL="+url+"\n",document.head.appendChild(script),script},Extension}();exports.default=Extension}),$__System.registerDynamic("c",["d","e","b"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}());Object.defineProperty(exports,"__esModule",{value:!0});var EDITOR,babylonjs_1=$__require("d"),extensions_1=$__require("e"),extension_1=$__require("b"),template="\nEDITOR.ParticlesCreator.Constructors['{{name}}'] = function (scene, particleSystem) {\n{{code}}\n}\n";!function(EDITOR){var ParticlesCreator=function(){function ParticlesCreator(){}return ParticlesCreator.Constructors={},ParticlesCreator}();EDITOR.ParticlesCreator=ParticlesCreator}(EDITOR=exports.EDITOR||(exports.EDITOR={})),window.EDITOR=window.EDITOR||{},window.EDITOR.ParticlesCreator=EDITOR.ParticlesCreator;var ParticlesCreatorExtension=function(_super){function ParticlesCreatorExtension(scene){var _this=_super.call(this,scene)||this;return _this.instances={},_this.datas=[],_this}return __extends(ParticlesCreatorExtension,_super),ParticlesCreatorExtension.prototype.onApply=function(data,rootUrl){var _this=this;this.datas=data,data.forEach(function(d){if(d.apply){var id=d.id+babylonjs_1.Tools.RandomId(),ps=_this.scene.getParticleSystemByID(d.id);if(ps){var url=window.location.href;url=url.replace(babylonjs_1.Tools.GetFilename(url),"")+"particle-systems/"+d.id.replace(/ /g,"")+".js",extension_1.default.AddScript(template.replace("{{name}}",id).replace("{{code}}",d.compiledCode||d.code),url);var ctor=new EDITOR.ParticlesCreator.Constructors[id](_this.scene,ps),code=new(ctor.ctor||ctor),uniforms=[],samplers=[],defines=[];code.setUniforms(uniforms,samplers),code.setDefines(defines),babylonjs_1.Effect.ShadersStore[id+"VertexShader"]=d.vertex,babylonjs_1.Effect.ShadersStore[id+"PixelShader"]=d.pixel;var effect=_this.scene.getEngine().createEffectForParticles(id,uniforms,samplers,defines.join("\n"));effect.onBind=function(effect){return code.onBind(effect)},ps.customShader=effect,_this.instances[d.id]=code}}})},ParticlesCreatorExtension.prototype.onSerialize=function(){var datas=[];return this.scene.particleSystems.forEach(function(ps){ps.metadata&&ps.metadata.particlesCreator&&(ps.metadata.particlesCreator.id=ps.id,datas.push(ps.metadata.particlesCreator))}),datas},ParticlesCreatorExtension.prototype.onLoad=function(data){var _this=this;data.forEach(function(d){var ps=_this.scene.getParticleSystemByID(d.id);ps&&(ps.metadata=ps.metadata||{},ps.metadata.particlesCreator=d)})},ParticlesCreatorExtension}(extension_1.default);exports.default=ParticlesCreatorExtension,extensions_1.default.Register("ParticlesCreatorExtension",ParticlesCreatorExtension)}),$__System.registerDynamic("a",["d","f","c","e"],!0,function($__require,exports,module){"use strict";var __extends=(this||self,exports&&exports.__extends||function(){var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])})(d,b)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}()),__awaiter=exports&&exports.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=exports&&exports.__generator||function(thisArg,body){function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");for(;_;)try{if(f=1,y&&(t=2&op[0]?y.return:op[0]?y.throw||((t=y.return)&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;switch(y=0,t&&(op=[2&op[0],t.value]),op[0]){case 0:case 1:t=op;break;case 4:return _.label++,{value:op[1],done:!1};case 5:_.label++,y=op[1],op=[0];continue;case 7:op=_.ops.pop(),_.trys.pop();continue;default:if(t=_.trys,!(t=t.length>0&&t[t.length-1])&&(6===op[0]||2===op[0])){_=0;continue}if(3===op[0]&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(6===op[0]&&_.label<t[1]){_.label=t[1],t=op;break}if(t&&_.label<t[2]){_.label=t[2],_.ops.push(op);break}t[2]&&_.ops.pop(),_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e],y=0}finally{f=t=0}if(5&op[0])throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}var f,y,t,g,_={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(g[Symbol.iterator]=function(){return this}),g};Object.defineProperty(exports,"__esModule",{value:!0});var babylonjs_1=$__require("d"),babylonjs_editor_1=$__require("f");$__require("c");var extensions_1=$__require("e"),ParticlesCreator=function(_super){function ParticlesCreator(editor){var _this=_super.call(this,"Particles Creator")||this;return _this.editor=editor,_this.layout=null,_this.toolbar=null,_this.functionsCode=null,_this.pixelCode=null,_this.vertexCode=null,_this.data=null,_this.currentTab="PARTICLES-CREATOR-FUNCTIONS",_this.resizeEvent=null,_this.selectedObjectEvent=null,_this}return __extends(ParticlesCreator,_super),ParticlesCreator.prototype.close=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return this.layout.element.destroy(),this.toolbar.element.destroy(),this.functionsCode.editor.dispose(),this.vertexCode.editor.dispose(),this.pixelCode.editor.dispose(),this.editor.core.onResize.remove(this.resizeEvent),this.editor.core.onSelectObject.remove(this.selectedObjectEvent),[4,_super.prototype.close.call(this)];case 1:return _a.sent(),[2]}})})},ParticlesCreator.prototype.create=function(){return __awaiter(this,void 0,void 0,function(){var _a,_b,_c,_d,_e,_f,_this=this;return __generator(this,function(_g){switch(_g.label){case 0:return(_a=!ParticlesCreator.DefaultCode)?(_b=ParticlesCreator,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/particles-creator/class.ts")]):[3,2];case 1:_a=_b.DefaultCode=_g.sent(),_g.label=2;case 2:return(_c=!ParticlesCreator.DefaultVertex)?(_d=ParticlesCreator,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/particles-creator/shader.vertex.fx")]):[3,4];case 3:_c=_d.DefaultVertex=_g.sent(),_g.label=4;case 4:return(_e=!ParticlesCreator.DefaultPixel)?(_f=ParticlesCreator,[4,babylonjs_editor_1.Tools.LoadFile("./assets/templates/particles-creator/shader.fragment.fx")]):[3,6];case 5:_e=_f.DefaultPixel=_g.sent(),_g.label=6;case 6:return this.layout=new babylonjs_editor_1.Layout(this.divElement.id),this.layout.panels=[{type:"top",size:32,resizable:!1,content:'<div id="PARTICLES-CREATOR-TOOLBAR" style="width: 100%; height: 100%"></div>'},{type:"main",resizable:!1,content:'\n                    <div id="PARTICLES-CREATOR-FUNCTIONS" style="width: 100%; height: 100%;"></div>\n                    <div id="PARTICLES-CREATOR-VERTEX" style="width: 100%; height: 100%; display: none;"></div>\n                    <div id="PARTICLES-CREATOR-PIXEL" style="width: 100%; height: 100%; display: none;"></div>\n                ',tabs:[{id:"functions",caption:"Functions"},{id:"vertex",caption:"Vertex Shader"},{id:"pixel",caption:"Pixel Shader"}]}],this.layout.build(this.divElement.id),this.toolbar=new babylonjs_editor_1.Toolbar("PARTICLES-CREATOR-TOOLBAR"),this.toolbar.items=[{type:"button",id:"apply",img:"icon-play-game-windowed",text:"Apply"},{type:"break"},{type:"button",img:"icon-add",text:"Import From..."}],this.toolbar.onClick=function(id){return _this.toolbarClicked(id)},this.toolbar.build("PARTICLES-CREATOR-TOOLBAR"),this.functionsCode=new babylonjs_editor_1.CodeEditor("typescript",""),[4,this.functionsCode.build("PARTICLES-CREATOR-FUNCTIONS")];case 7:return _g.sent(),this.functionsCode.onChange=function(value){_this.data&&(_this.data.code=value,_this.data.compiledCode=_this.functionsCode.transpileTypeScript(value,_this.data.id.replace(/ /,"")))},this.vertexCode=new babylonjs_editor_1.CodeEditor("cpp",""),[4,this.vertexCode.build("PARTICLES-CREATOR-VERTEX")];case 8:return _g.sent(),this.vertexCode.onChange=function(value){return _this.data&&(_this.data.vertex=value)},this.pixelCode=new babylonjs_editor_1.CodeEditor("cpp",""),[4,this.pixelCode.build("PARTICLES-CREATOR-PIXEL")];case 9:return _g.sent(),this.pixelCode.onChange=function(value){return _this.data&&(_this.data.pixel=value)},this.resizeEvent=this.editor.core.onResize.add(function(_){return _this.resize()}),this.selectedObjectEvent=this.editor.core.onSelectObject.add(function(obj){return _this.selectObject(obj)}),this.layout.getPanelFromType("main").tabs.on("click",function(ev){$("#"+_this.currentTab).hide(),_this.currentTab="PARTICLES-CREATOR-"+ev.target.toUpperCase(),$("#"+_this.currentTab).show()}),extensions_1.default.RequestExtension(this.editor.core.scene,"ParticlesCreatorExtension"),this.selectObject(this.editor.core.currentSelectedObject),[2]}})})},ParticlesCreator.prototype.onHide=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},ParticlesCreator.prototype.onShow=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2]})})},ParticlesCreator.prototype.resize=function(){this.layout.element.resize()},ParticlesCreator.prototype.selectObject=function(object){if(!(object instanceof babylonjs_1.ParticleSystem))return this.data=null,this.functionsCode.setValue(""),this.vertexCode.setValue(""),this.pixelCode.setValue(""),void this.layout.lockPanel("main","No Particle System Selected...");object.metadata=object.metadata||{},this.data=object.metadata.particlesCreator||{id:object.id,apply:!1,code:ParticlesCreator.DefaultCode,vertex:ParticlesCreator.DefaultVertex,pixel:ParticlesCreator.DefaultPixel},object.metadata.particlesCreator=this.data,this.layout.unlockPanel("main"),this.functionsCode.setValue(this.data.code),this.vertexCode.setValue(this.data.vertex),this.pixelCode.setValue(this.data.pixel)},ParticlesCreator.prototype.toolbarClicked=function(id){if(this.data)switch(id){case"apply":var checked=this.toolbar.isChecked(id,!0);this.data.apply=checked,this.toolbar.setChecked(id,checked)}},ParticlesCreator.DefaultCode="",ParticlesCreator.DefaultVertex="",ParticlesCreator.DefaultPixel="",ParticlesCreator}(babylonjs_editor_1.EditorPlugin);exports.default=ParticlesCreator})})(function(factory){module.exports=factory(require("babylonjs"),require("babylonjs-editor"),require("extensions/extensions.js"))});